apiVersion: v1alpha1
kind: Setting
metadata:
  name: cdn-cache-settings
spec:
  forms:
    - group: basic
      label: 基本设置
      formSchema:
        - $formkit: checkbox
          name: enabled
          label: 启用 CDN 缓存刷新
          help: 开启后，文章发布或更新时将自动刷新相关页面的 CDN 缓存
          value: false

        - $formkit: text
          name: siteDomain
          label: 站点域名
          help: 您的站点域名，例如 https://example.com
          placeholder: https://example.com

    - group: providers
      label: CDN 提供商
      formSchema:
        - $formkit: array
          name: cdnProviders
          label: CDN 提供商配置
          help: 可以添加多个 CDN 提供商，发布文章时会同时刷新所有启用的 CDN
          min: 0
          max: 10
          value: []
          addLabel: 添加 CDN 提供商
          itemLabels:
            - type: text
              label: "$value.name"
          children:
            - $formkit: text
              name: name
              label: 配置名称
              help: 用于标识此配置，例如"主站 CDN"、"备用 CDN"
              placeholder: 我的 CDN
              validation: required

            - $formkit: checkbox
              name: enabled
              label: 启用此配置
              value: true

            - $formkit: select
              name: provider
              label: CDN 提供商
              help: 选择 CDN 服务提供商
              value: ALIYUN
              validation: required
              options:
                - label: 阿里云 CDN
                  value: ALIYUN
                - label: 阿里云 ESA（边缘安全加速）
                  value: ALIYUN_ESA
                - label: 腾讯云 CDN
                  value: TENCENT
                - label: 腾讯云 EdgeOne
                  value: TENCENT_EDGEONE
                - label: Cloudflare
                  value: CLOUDFLARE
                - label: 自定义 PURGE
                  value: CUSTOM_PURGE

            # 阿里云 CDN / 阿里云 ESA / 腾讯云 CDN / 腾讯云 EdgeOne 需要
            - $formkit: text
              name: accessKeyId
              label: Access Key ID
              help: 阿里云/腾讯云的 Access Key ID
              if: "$value.provider === 'ALIYUN' || $value.provider === 'ALIYUN_ESA' || $value.provider === 'TENCENT' || $value.provider === 'TENCENT_EDGEONE'"
              validation: required

            - $formkit: password
              name: accessKeySecret
              label: Access Key Secret
              help: 阿里云/腾讯云的 Access Key Secret
              if: "$value.provider === 'ALIYUN' || $value.provider === 'ALIYUN_ESA' || $value.provider === 'TENCENT' || $value.provider === 'TENCENT_EDGEONE'"
              validation: required

            # Cloudflare 专用
            - $formkit: password
              name: cloudflareToken
              label: Cloudflare API Token
              help: 需要 Zone.Cache Purge 权限的 API Token
              if: "$value.provider === 'CLOUDFLARE'"
              validation: required

            # 阿里云 ESA 需要 Site ID
            - $formkit: text
              name: zoneId
              label: Site ID
              help: 阿里云 ESA 的站点 ID
              if: "$value.provider === 'ALIYUN_ESA'"
              validation: required

            # 腾讯云 EdgeOne 需要 Zone ID
            - $formkit: text
              name: zoneId
              label: Zone ID
              help: 腾讯云 EdgeOne 的 Zone ID
              if: "$value.provider === 'TENCENT_EDGEONE'"
              validation: required

            # Cloudflare 需要 Zone ID
            - $formkit: text
              name: zoneId
              label: Zone ID
              help: Cloudflare 的 Zone ID，在域名概述页面可以找到
              if: "$value.provider === 'CLOUDFLARE'"
              validation: required

            # 自定义 PURGE 配置 - 使用 textarea，每行一个 header，格式为 name:value
            - $formkit: textarea
              name: customHeadersText
              label: 自定义请求头
              help: "PURGE 请求需要携带的 HTTP Headers，每行一个，格式为 Header名称:Header值，例如：X-Cloud-Purge-Key:your-api-key"
              placeholder: "X-Cloud-Purge-Key:your-api-key"
              if: "$value.provider === 'CUSTOM_PURGE'"

            - $formkit: text
              name: successKeyword
              label: 成功判断关键字
              help: 响应内容中包含此字符串则认为清除成功，例如 "success" 或 "ok"
              placeholder: success
              if: "$value.provider === 'CUSTOM_PURGE'"
              validation: required

    - group: routes
      label: 路由设置
      formSchema:
        - $formkit: text
          name: archiveRoute
          label: 归档页路由
          help: 文章归档页的路由，默认是 archives
          value: archives
          placeholder: archives

        - $formkit: text
          name: categoryRoute
          label: 分类页路由
          help: 分类页的路由，默认是 categories
          value: categories
          placeholder: categories

        - $formkit: text
          name: tagRoute
          label: 标签页路由
          help: 标签页的路由，默认是 tags
          value: tags
          placeholder: tags

    - group: refresh
      label: 刷新选项
      formSchema:
        - $formkit: checkbox
          name: refreshHomePage
          label: 刷新首页
          help: 文章发布时是否刷新首页缓存
          value: true

        - $formkit: checkbox
          name: refreshArchivePage
          label: 刷新归档页
          help: 文章发布时是否刷新文章归档页缓存
          value: true

        - $formkit: checkbox
          name: refreshCategoryPage
          label: 刷新分类页
          help: 文章发布时是否刷新分类页缓存
          value: true

        - $formkit: checkbox
          name: refreshTagPage
          label: 刷新标签页
          help: 文章发布时是否刷新标签页缓存
          value: true

        - $formkit: checkbox
          name: refreshOnComment
          label: 评论后刷新
          help: 评论审核通过后是否刷新对应文章页面的缓存
          value: true

        - $formkit: textarea
          name: customPaths
          label: 自定义刷新路径
          help: 额外需要刷新的路径，多个路径用英文逗号分隔，例如：/about,/links,/sitemap.xml
          placeholder: /about,/links
